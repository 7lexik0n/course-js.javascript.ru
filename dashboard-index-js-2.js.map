{"version":3,"sources":["webpack:///./src/components/sortable-table/index.js","webpack:///./src/components/range-picker/index.js","webpack:///./src/components/column-chart/index.js","webpack:///./src/pages/dashboard/bestsellers-header.js","webpack:///./src/pages/dashboard/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableTable","constructor","headersConfig","url","sorted","id","find","item","sortable","order","isSortLocally","step","start","end","from","to","this","async","bottom","element","getBoundingClientRect","document","documentElement","clientHeight","loading","data","loadData","update","event","column","target","closest","dataset","newOrder","asc","desc","toggleOrder","append","subElements","arrow","sortOnClient","resetCountParams","sortOnServer","URL","process","titleLike","status","render","wrapper","createElement","innerHTML","getTable","firstElementChild","getSubElements","renderRows","initEventListeners","searchParams","set","toISOString","delete","decodeURI","prices","classList","add","fetchJson","toString","remove","addRows","body","getTableRows","rows","childNodes","filterByName","name","getNewData","filterByStatus","filterByPrice","getTableHeader","map","getHeaderRow","join","title","getHeaderSortingArrow","getTableBody","getTableRow","template","header","addEventListener","onSortClick","onWindowScroll","sortedData","sortData","length","arr","sortType","customSorting","direction","sort","a","b","localeCompare","querySelectorAll","reduce","accum","subElement","removeEventListener","destroy","RangePicker","date","toLocaleString","dateStyle","Date","isOpen","contains","isRangePicker","close","showDateFrom","selected","formatDate","input","selector","onDocumentClick","toggle","onSelectorClick","renderDateRangePicker","onRangePickerCellClick","showDate1","showDate2","setMonth","getMonth","renderCalendar","controlLeft","querySelector","controlRight","prev","next","renderHighlight","cell","value","cellDate","selectedFromElem","selectedToElem","showDate","setDate","monthStr","month","table","dayIndex","getDay","getDate","dateValue","selectingFrom","dispatchEvent","CustomEvent","bubbles","detail","ColumnChart","range","className","label","link","formatHeading","chartHeight","getLink","getColumnBody","values","maxValue","Math","max","scale","toFixed","floor","getTooltip","toLocaleDateString","year","day","startDate","endDate","startLoading","toJSON","response","href","Object","entries","setHeader","finishLoading","category","Page","getTemplate","progressBar","initComponents","renderComponents","addEventListeners","sortableTable","ordersChart","salesChart","customersChart","components","now","rangePicker","formatSales","forEach","component","updateComponents","style","currency","minimumFractionDigits","params","fetch","err","FetchError","ok","errorText","statusText","json","error","message","Error","super","window","reason","alert"],"mappings":"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","file":"dashboard-index-js-2.js","sourcesContent":["import fetchJson from \"../../utils/fetch-json.js\";\r\n\r\nexport default class SortableTable {\r\n  element;\r\n  subElements = {};\r\n  data = [];\r\n  loading = false;\r\n  step = 20;\r\n  start = 1;\r\n  end = this.start + this.step;\r\n\r\n  onWindowScroll = async() => {\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n    const { id, order } = this.sorted;\r\n    \r\n    if (bottom < document.documentElement.clientHeight && !this.loading && !this.isSortLocally) {\r\n      this.start = this.end;\r\n      this.end = this.start + this.step;\r\n\r\n      this.loading = true;\r\n\r\n      const data = await this.loadData(id, order, this.start, this.end);\r\n      this.update(data);\r\n\r\n      this.loading = false;\r\n    }\r\n  };\r\n\r\n  onSortClick = event => {\r\n    const column = event.target.closest('[data-sortable=\"true\"]');\r\n    const toggleOrder = order => {\r\n      const orders = {\r\n        asc: 'desc',\r\n        desc: 'asc'\r\n      };\r\n\r\n      return orders[order];\r\n    };\r\n\r\n    if (column) {\r\n      const { id, order } = column.dataset;\r\n      const newOrder = toggleOrder(order);\r\n\r\n      this.sorted = {\r\n        id,\r\n        order: newOrder\r\n      };\r\n\r\n      column.dataset.order = newOrder;\r\n      column.append(this.subElements.arrow);\r\n\r\n      if (this.isSortLocally) {\r\n        this.sortOnClient(id, newOrder);\r\n      } else {\r\n        this.resetCountParams();\r\n        this.sortOnServer(id, newOrder);\r\n      }\r\n    }\r\n  };\r\n\r\n  constructor(headersConfig = [], {\r\n    url = '',\r\n    sorted = {\r\n      id: headersConfig.find(item => item.sortable).id,\r\n      order: 'asc'\r\n    },\r\n    isSortLocally = false,\r\n    step = 20,\r\n    start = 0,\r\n    end = start + step,\r\n    from,\r\n    to\r\n  } = {}) {\r\n\r\n    this.headersConfig = headersConfig;\r\n    this.url = new URL(url, process.env.BACKEND_URL);\r\n    this.sorted = sorted;\r\n    this.isSortLocally = isSortLocally;\r\n    this.step = step;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.from = from;\r\n    this.to = to;\r\n    this.titleLike = '';\r\n    this.status = '';\r\n\r\n    this.render();\r\n  }\r\n\r\n  async render() {\r\n    const {id, order} = this.sorted;\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTable();\r\n\r\n    const element = wrapper.firstElementChild;\r\n\r\n    this.element = element;\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    const data = await this.loadData(id, order, this.start, this.end);\r\n\r\n    this.renderRows(data);\r\n    this.initEventListeners();\r\n  }\r\n\r\n  async loadData(\r\n    id = this.sorted.id,\r\n    order = this.sorted.order,\r\n    start = this.start,\r\n    end = this.end,\r\n    from = this.from,\r\n    to = this.to\r\n    ) {\r\n    this.url.searchParams.set('_sort', id);\r\n    this.url.searchParams.set('_order', order);\r\n    this.url.searchParams.set('_start', start);\r\n    this.url.searchParams.set('_end', end);\r\n\r\n    if (from) {\r\n      this.url.searchParams.set('from', from.toISOString());\r\n    }\r\n    \r\n    if (to) {\r\n      this.url.searchParams.set('to', to.toISOString());\r\n    }\r\n\r\n    this.url.searchParams.delete('title_like');\r\n    if (this.titleLike !== '') {\r\n      this.url.searchParams.set('title_like', decodeURI(this.titleLike));\r\n    }\r\n\r\n    this.url.searchParams.delete('status');\r\n    if (this.status !== '') {\r\n      this.url.searchParams.set('status', this.status);\r\n    }\r\n\r\n    if (this.prices) {\r\n      const { from, to } = this.prices;\r\n\r\n      this.url.searchParams.set('price_gte', from);\r\n      this.url.searchParams.set('price_lte', to);\r\n    }\r\n\r\n    this.element.classList.add('sortable-table_loading');\r\n\r\n    const data = await fetchJson(this.url.toString());\r\n\r\n    this.element.classList.remove('sortable-table_loading');\r\n\r\n    return data;\r\n  }\r\n\r\n  addRows(data) {\r\n    this.data = data;\r\n\r\n    this.subElements.body.innerHTML = this.getTableRows(data);\r\n  }\r\n\r\n  update(data) {\r\n    const rows = document.createElement('div');\r\n\r\n    this.data = [...this.data, ...data];\r\n    rows.innerHTML = this.getTableRows(data);\r\n\r\n    this.subElements.body.append(...rows.childNodes);\r\n  }\r\n\r\n  filterByName(name) {\r\n    this.titleLike = name;\r\n\r\n    this.getNewData();\r\n  }\r\n\r\n  filterByStatus(status) {\r\n    this.status = status;\r\n\r\n    this.getNewData();\r\n  }\r\n\r\n  filterByPrice({ from, to }) {\r\n    this.prices = {from, to};\r\n\r\n    this.getNewData();\r\n  }\r\n\r\n  async getNewData() {\r\n    this.resetCountParams();\r\n\r\n    const data = await this.loadData();\r\n\r\n    this.renderRows(data);\r\n  }\r\n\r\n  getTableHeader() {\r\n    return `<div data-element=\"header\" class=\"sortable-table__header sortable-table__row\">\r\n      ${this.headersConfig.map(item => this.getHeaderRow(item)).join('')}\r\n    </div>`;\r\n  }\r\n\r\n  getHeaderRow({id, title, sortable}) {\r\n    const order = this.sorted.id === id ? this.sorted.order : 'asc';\r\n\r\n    return `\r\n      <div class=\"sortable-table__cell\" data-id=\"${id}\" data-sortable=\"${sortable}\" data-order=\"${order}\">\r\n        <span>${title}</span>\r\n        ${this.getHeaderSortingArrow(id)}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getHeaderSortingArrow(id) {\r\n    const isOrderExist = this.sorted.id === id ? this.sorted.order : '';\r\n\r\n    return isOrderExist\r\n      ? `<span data-element=\"arrow\" class=\"sortable-table__sort-arrow\">\r\n          <span class=\"sort-arrow\"></span>\r\n        </span>`\r\n      : '';\r\n  }\r\n\r\n  getTableBody(data) {\r\n    return `\r\n      <div data-element=\"body\" class=\"sortable-table__body\">\r\n        ${this.getTableRows(data)}\r\n      </div>`;\r\n  }\r\n\r\n  getTableRows(data) {\r\n    return data.map(item => `\r\n      <a href=\"/products/${item.id}\" class=\"sortable-table__row\">\r\n        ${this.getTableRow(item, data)}\r\n      </a>`\r\n    ).join('');\r\n  }\r\n\r\n  getTableRow(item) {\r\n    const cells = this.headersConfig.map(({id, template}) => {\r\n      return {\r\n        id,\r\n        template\r\n      };\r\n    });\r\n\r\n    return cells.map(({id, template}) => {\r\n      return template\r\n        ? template(item[id])\r\n        : `<div class=\"sortable-table__cell\">${item[id]}</div>`;\r\n    }).join('');\r\n  }\r\n\r\n  getTable() {\r\n    return `\r\n      <div class=\"sortable-table\">\r\n        ${this.getTableHeader()}\r\n        ${this.getTableBody(this.data)}\r\n\r\n        <div data-element=\"loading\" class=\"loading-line sortable-table__loading-line\"></div>\r\n\r\n        <div data-element=\"emptyPlaceholder\" class=\"sortable-table__empty-placeholder\">\r\n          No products\r\n        </div>\r\n      </div>`;\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.subElements.header.addEventListener('pointerdown', this.onSortClick);\r\n    document.addEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  sortOnClient(id, order) {\r\n    const sortedData = this.sortData(id, order);\r\n\r\n    this.subElements.body.innerHTML = this.getTableRows(sortedData);\r\n  }\r\n\r\n  async sortOnServer(\r\n    id,\r\n    order,\r\n    start = this.start,\r\n    end = this.end\r\n  ) {\r\n    const data = await this.loadData(id, order, start, end);\r\n\r\n    this.renderRows(data);\r\n  }\r\n\r\n  renderRows(data) {\r\n    if (data.length) {\r\n      this.element.classList.remove('sortable-table_empty');\r\n      this.addRows(data);\r\n    } else {\r\n      this.element.classList.add('sortable-table_empty');\r\n    }\r\n  }\r\n\r\n  sortData(id, order) {\r\n    const arr = [...this.data];\r\n    const column = this.headersConfig.find(item => item.id === id);\r\n    const {sortType, customSorting} = column;\r\n    const direction = order === 'asc' ? 1 : -1;\r\n\r\n    return arr.sort((a, b) => {\r\n      switch (sortType) {\r\n      case 'number':\r\n        return direction * (a[id] - b[id]);\r\n      case 'string':\r\n        return direction * a[id].localeCompare(b[id], 'ru');\r\n      case 'custom':\r\n        return direction * customSorting(a, b);\r\n      default:\r\n        return direction * (a[id] - b[id]);\r\n      }\r\n    });\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  resetCountParams() {\r\n    this.start = 0;\r\n    this.end = this.step;\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.subElements = {};\r\n  }\r\n}\r\n","export default class RangePicker {\r\n  element = null;\r\n  subElements = {};\r\n  selectingFrom = true;\r\n  selected = {\r\n    from: new Date(),\r\n    to: new Date()\r\n  };\r\n\r\n  static formatDate(date) {\r\n    return date.toLocaleString('ru', {dateStyle: 'short'});\r\n  }\r\n\r\n  onDocumentClick = event => {\r\n    const isOpen = this.element.classList.contains('rangepicker_open');\r\n    const isRangePicker = this.element.contains(event.target);\r\n\r\n    if (isOpen && !isRangePicker) {\r\n      this.close();\r\n    }\r\n  };\r\n\r\n  constructor({from = new Date(), to = new Date()} = {}) {\r\n    this.showDateFrom = new Date(from);\r\n    this.selected = {from, to};\r\n\r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    const from = RangePicker.formatDate(this.selected.from);\r\n    const to = RangePicker.formatDate(this.selected.to);\r\n\r\n    return `<div class=\"rangepicker\">\r\n      <div class=\"rangepicker__input\" data-element=\"input\">\r\n        <span data-element=\"from\">${from}</span> -\r\n        <span data-element=\"to\">${to}</span>\r\n      </div>\r\n      <div class=\"rangepicker__selector\" data-element=\"selector\"></div>\r\n    </div>`;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    this.initEventListeners();\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const subElements = {};\r\n\r\n    for (const subElement of element.querySelectorAll('[data-element]')) {\r\n      subElements[subElement.dataset.element] = subElement;\r\n    }\r\n\r\n    return subElements;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const {input, selector} = this.subElements;\r\n\r\n    document.addEventListener('click', this.onDocumentClick, true);\r\n    input.addEventListener('click', () => this.toggle());\r\n    selector.addEventListener('click', event => this.onSelectorClick(event));\r\n  }\r\n\r\n  toggle() {\r\n    this.element.classList.toggle('rangepicker_open');\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  onSelectorClick({target}) {\r\n    if (target.classList.contains('rangepicker__cell')) {\r\n      this.onRangePickerCellClick(target);\r\n    }\r\n  }\r\n\r\n  close() {\r\n    this.element.classList.remove('rangepicker_open');\r\n  }\r\n\r\n  renderDateRangePicker() {\r\n    const showDate1 = new Date(this.showDateFrom);\r\n    const showDate2 = new Date(this.showDateFrom);\r\n    const { selector } = this.subElements;\r\n\r\n    showDate2.setMonth(showDate2.getMonth() + 1);\r\n\r\n    selector.innerHTML = `\r\n      <div class=\"rangepicker__selector-arrow\"></div>\r\n      <div class=\"rangepicker__selector-control-left\"></div>\r\n      <div class=\"rangepicker__selector-control-right\"></div>\r\n      ${this.renderCalendar(showDate1)}\r\n      ${this.renderCalendar(showDate2)}\r\n    `;\r\n\r\n    const controlLeft = selector.querySelector('.rangepicker__selector-control-left');\r\n    const controlRight = selector.querySelector('.rangepicker__selector-control-right');\r\n\r\n    controlLeft.addEventListener('click', () => this.prev());\r\n    controlRight.addEventListener('click', () => this.next());\r\n\r\n    this.renderHighlight();\r\n  }\r\n\r\n  prev() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() - 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  next() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() + 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  renderHighlight() {\r\n    const { from, to } = this.selected;\r\n\r\n    for (const cell of this.element.querySelectorAll('.rangepicker__cell')) {\r\n      const { value } = cell.dataset;\r\n      const cellDate = new Date(value);\r\n\r\n      cell.classList.remove('rangepicker__selected-from');\r\n      cell.classList.remove('rangepicker__selected-between');\r\n      cell.classList.remove('rangepicker__selected-to');\r\n\r\n      if (from && value === from.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-from');\r\n      } else if (to && value === to.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-to');\r\n      } else if (from && to && cellDate >= from && cellDate <= to) {\r\n        cell.classList.add('rangepicker__selected-between');\r\n      }\r\n    }\r\n\r\n    if (from) {\r\n      const selectedFromElem = this.element.querySelector(`[data-value=\"${from.toISOString()}\"]`);\r\n      if (selectedFromElem) {\r\n        selectedFromElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-from');\r\n      }\r\n    }\r\n\r\n    if (to) {\r\n      const selectedToElem = this.element.querySelector(`[data-value=\"${to.toISOString()}\"]`);\r\n      if (selectedToElem) {\r\n        selectedToElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-to');\r\n      }\r\n    }\r\n  }\r\n\r\n  renderCalendar(showDate) {\r\n    const date = new Date(showDate);\r\n    const getGridStartIndex = dayIndex => {\r\n      const index = dayIndex === 0 ? 6 : (dayIndex - 1); // make Sunday (0) the last day\r\n      return index + 1;\r\n    };\r\n\r\n    date.setDate(1);\r\n\r\n    // text-transform: capitalize\r\n    const monthStr = date.toLocaleString('ru', {month: 'long'});\r\n\r\n    let table = `<div class=\"rangepicker__calendar\">\r\n      <div class=\"rangepicker__month-indicator\">\r\n        <time datetime=${monthStr}>${monthStr}</time>\r\n      </div>\r\n      <div class=\"rangepicker__day-of-week\">\r\n        <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>\r\n      </div>\r\n      <div class=\"rangepicker__date-grid\">\r\n    `;\r\n\r\n    // first day of month starts after a space\r\n    // * * * 1 2 3 4\r\n    table += `\r\n      <button type=\"button\"\r\n        class=\"rangepicker__cell\"\r\n        data-value=\"${date.toISOString()}\"\r\n        style=\"--start-from: ${getGridStartIndex(date.getDay())}\">\r\n          ${date.getDate()}\r\n      </button>`;\r\n\r\n    date.setDate(2);\r\n\r\n    while (date.getMonth() === showDate.getMonth()) {\r\n      table += `\r\n        <button type=\"button\"\r\n          class=\"rangepicker__cell\"\r\n          data-value=\"${date.toISOString()}\">\r\n            ${date.getDate()}\r\n        </button>`;\r\n\r\n      date.setDate(date.getDate() + 1);\r\n    }\r\n\r\n    // close the table\r\n    table += '</div></div>';\r\n\r\n    return table;\r\n  }\r\n\r\n  onRangePickerCellClick(target) {\r\n    const { value } = target.dataset;\r\n\r\n    if (value) {\r\n      const dateValue = new Date(value);\r\n\r\n      if (this.selectingFrom) {\r\n        this.selected = {\r\n          from: dateValue,\r\n          to: null\r\n        };\r\n        this.selectingFrom = false;\r\n        this.renderHighlight();\r\n      } else {\r\n        if (dateValue > this.selected.from) {\r\n          this.selected.to = dateValue;\r\n        } else {\r\n          this.selected.to = this.selected.from;\r\n          this.selected.from = dateValue;\r\n        }\r\n\r\n        this.selectingFrom = true;\r\n        this.renderHighlight();\r\n      }\r\n\r\n      if (this.selected.from && this.selected.to) {\r\n        this.dispatchEvent();\r\n        this.close();\r\n        this.subElements.from.innerHTML = RangePicker.formatDate(this.selected.from);\r\n        this.subElements.to.innerHTML = RangePicker.formatDate(this.selected.to);\r\n      }\r\n    }\r\n  }\r\n\r\n  dispatchEvent() {\r\n    this.element.dispatchEvent(new CustomEvent('date-select', {\r\n      bubbles: true,\r\n      detail: this.selected\r\n    }));\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    // TODO: Warning! To remove listener MUST be passes the same event phase\r\n    document.removeEventListener('click', this.onDocumentClick, true);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = {};\r\n    this.selectingFrom = true;\r\n    this.selected = {\r\n      from: new Date(),\r\n      to: new Date()\r\n    };\r\n\r\n    return this;\r\n  }\r\n}\r\n","import fetchJson from '../../utils/fetch-json.js';\r\n\r\nexport default class ColumnChart {\r\n  element = null;\r\n  subElements = {};\r\n  chartHeight = 50;\r\n\r\n  constructor({\r\n    url = '',\r\n    range = {\r\n      from: new Date(),\r\n      to: new Date()\r\n    },\r\n    data = [],\r\n    className = '',\r\n    label = '',\r\n    link = '',\r\n    value = 0,\r\n    formatHeading = data => `${data}`\r\n  } = {}) {\r\n    this.url = url;\r\n    this.range = range;\r\n    this.data = data;\r\n    this.className = className;\r\n    this.label = label;\r\n    this.link = link;\r\n    this.value = value;\r\n    this.formatHeading = formatHeading;\r\n\r\n    this.render();\r\n    this.update(this.range.from, this.range.to);\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"column-chart column-chart_loading column-chart_${this.className}\" style=\"--chart-height: ${this.chartHeight}\">\r\n        <div class=\"column-chart__title\">\r\n          ${this.label}\r\n          ${this.getLink()}\r\n        </div>\r\n\r\n        <div class=\"column-chart__container\">\r\n          <div data-element=\"header\" class=\"column-chart__header\">${this.formatHeading(this.value)}</div>\r\n          <div data-element=\"body\" class=\"column-chart__chart\">\r\n            ${this.getColumnBody(this.data)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getLink() {\r\n    return this.link ? `<a class=\"column-chart__link\" href=\"${this.link}\">Подробнее</a>` : ``;\r\n  }\r\n\r\n  getColumnBody(data) {\r\n    const values = data.map(item => item[1]);\r\n    const maxValue = Math.max(...values);\r\n    const scale = this.chartHeight / maxValue;\r\n\r\n    return data\r\n      .map(item => {\r\n        const percent = (item[1] / maxValue * 100).toFixed(0);\r\n        // console.log(this.getTooltip(item));\r\n\r\n        return `<div style=\"--value: ${Math.floor(item[1] * scale)}\" data-tooltip=\"${this.getTooltip(item)}\"></div>`;\r\n      })\r\n      .join('');\r\n  }\r\n\r\n  getTooltip([ date = new Date(), value = 0 ] = []) {\r\n    const dataOptions = {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    };\r\n\r\n    const formatedDate = new Date(date).toLocaleDateString('ru-RU', dataOptions);\r\n\r\n    return `<div><small>${formatedDate}</small></div><strong>${this.formatHeading(value)}</strong>`;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements(this.element);\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  async update(startDate, endDate) {\r\n    this.startLoading();\r\n\r\n    const url = new URL(this.url, process.env.BACKEND_URL);\r\n\r\n    url.searchParams.set('from', startDate.toJSON());\r\n    url.searchParams.set('to', endDate.toJSON());\r\n\r\n    const response = await fetchJson(url.href);\r\n    \r\n    this.data = Object.entries(response);\r\n    \r\n    this.subElements.body.innerHTML = this.getColumnBody(this.data);\r\n    this.subElements.header.innerHTML = this.setHeader();\r\n\r\n    this.finishLoading();\r\n  }\r\n\r\n  startLoading() {\r\n    this.element.classList.add('column-chart_loading');\r\n  }\r\n\r\n  finishLoading() {\r\n    if (this.data.length) {\r\n      this.element.classList.remove('column-chart_loading');\r\n    }\r\n  }\r\n\r\n  setHeader() {\r\n    this.value = this.data.reduce((accum, item) => accum + item[1], 0);\r\n\r\n    return `${this.formatHeading(this.value)}`;\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    if (this.element) {\r\n      this.remove();\r\n      this.element = null;\r\n    }\r\n\r\n    this.subElements = {};\r\n  }\r\n}\r\n","const header = [\r\n  {\r\n    id: 'images',\r\n    title: 'Фото',\r\n    sortable: false,\r\n    template: data => {\r\n      return `\r\n          <div class=\"sortable-table__cell\">\r\n            <img class=\"sortable-table-image\" alt=\"Image\" src=\"${data[0] ? data[0].url : '../not-found.svg'}\">\r\n          </div>\r\n        `;\r\n    }\r\n  },\r\n  {\r\n    id: 'title',\r\n    title: 'Название',\r\n    sortable: true,\r\n    sortType: 'string'\r\n  },\r\n  {\r\n    id: 'subcategory',\r\n    title: 'Категория',\r\n    sortable: false,\r\n    sortType: 'string',\r\n    template: ({ title, category }) => {\r\n      const tooltipMessage = `\r\n        <div class='sortable-table-tooltip'>\r\n          <span class='sortable-table-tooltip__category'>${title}</span> / <b class='sortable-table-tooltip__subcategory'>${category.title}</b>\r\n        </div>\r\n      `;\r\n\r\n      return `\r\n          <div class=\"sortable-table__cell\">\r\n            <span data-tooltip=\"${tooltipMessage}\">\r\n              ${category.title}\r\n            </span>\r\n          </div>\r\n        `;\r\n    }\r\n  },\r\n  {\r\n    id: 'quantity',\r\n    title: 'Количество',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n  {\r\n    id: 'price',\r\n    title: 'Цена',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n  {\r\n    id: 'sales',\r\n    title: 'Продажи',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n];\r\n\r\nexport default header;\r\n","import RangePicker from '../../components/range-picker/index.js';\r\nimport SortableTable from '../../components/sortable-table/index.js';\r\nimport ColumnChart from '../../components/column-chart/index.js';\r\nimport header from './bestsellers-header.js';\r\n\r\nexport default class Page {\r\n  components = {};\r\n  subElements = {};\r\n\r\n  get getTemplate() {\r\n    return `\r\n      <div class=\"dashboard full-height flex-column\">\r\n        <div class=\"content__top-panel\">\r\n          <h2 class=\"page-title\">Панель управления</h2>\r\n          <div data-element=\"rangePicker\"></div>\r\n        </div>\r\n\r\n        <div data-element=\"chartsContainer\" class=\"dashboard__charts\">\r\n          <div data-element=\"ordersChart\" class=\"dashboard__chart_orders\"></div>\r\n          <div data-element=\"salesChart\" class=\"dashboard__chart_sales\"></div>\r\n          <div data-element=\"customersChart\" class=\"dashboard__chart_customers\"></div>\r\n        </div>\r\n\r\n        <h3 class=\"block-title\">Лидеры продаж</h3>\r\n        <div data-element=\"sortableTable\" class=\"sortable-table\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  get getSubElements() {\r\n    const subElements = this.element.querySelectorAll('[data-element]');\r\n\r\n    return [...subElements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  async render() {\r\n    const element = document.createElement('div');\r\n    element.innerHTML = this.getTemplate;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements;\r\n    this.subElements.progressBar = document.querySelector('.progress-bar');\r\n\r\n    this.initComponents();\r\n    this.renderComponents();\r\n    this.addEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  async updateComponents(from, to) {\r\n    const {\r\n      sortableTable,\r\n      ordersChart,\r\n      salesChart,\r\n      customersChart\r\n    } = this.components;\r\n\r\n    const data = await sortableTable.loadData(\r\n      sortableTable.sorted.id,\r\n      sortableTable.sorted.order,\r\n      0,\r\n      19,\r\n      from,\r\n      to\r\n    );\r\n\r\n    sortableTable.addRows(data);\r\n    ordersChart.update(from, to);\r\n    salesChart.update(from, to);\r\n    customersChart.update(from, to);\r\n  }\r\n\r\n  initComponents() {\r\n    const now = new Date();\r\n    const to = new Date();\r\n    const from = new Date(now.setMonth(now.getMonth() - 1));\r\n\r\n    const rangePicker = new RangePicker({\r\n      from,\r\n      to\r\n    });\r\n\r\n    const ordersChart = new ColumnChart({\r\n      url: 'api/dashboard/orders',\r\n      className: 'orders',\r\n      label: 'Заказы',\r\n      link: '/sales',\r\n      range: {\r\n        from,\r\n        to\r\n      }\r\n    });\r\n\r\n    const salesChart = new ColumnChart({\r\n      url: 'api/dashboard/sales',\r\n      className: 'sales',\r\n      label: 'Продажи',\r\n      formatHeading: data => this.formatSales(data),\r\n      range: {\r\n        from,\r\n        to\r\n      }\r\n    });\r\n\r\n    const customersChart = new ColumnChart({\r\n      url: 'api/dashboard/customers',\r\n      className: 'customers',\r\n      label: 'Клиенты',\r\n      range: {\r\n        from,\r\n        to\r\n      }\r\n    });\r\n\r\n    const sortableTable = new SortableTable(header, {\r\n      url: `api/dashboard/bestsellers`,\r\n      from,\r\n      to,\r\n      start: 0,\r\n      step: 30,\r\n      isSortLocally: true\r\n    });\r\n\r\n    this.components = {\r\n      rangePicker,\r\n      ordersChart,\r\n      salesChart,\r\n      customersChart,\r\n      sortableTable\r\n    };\r\n  }\r\n\r\n  renderComponents() {\r\n    Object.entries(this.components).forEach(([title, component]) => {\r\n      const container = this.subElements[title];\r\n\r\n      container.append(component.element);\r\n    });\r\n  }\r\n\r\n  addEventListeners() {\r\n    const { element } = this.components.rangePicker;\r\n\r\n    element.addEventListener('date-select', event => {\r\n      const { from, to } = event.detail;\r\n\r\n      this.updateComponents(from, to);\r\n    });\r\n  }\r\n\r\n  formatSales(data) {\r\n    return data.toLocaleString('en', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n      minimumFractionDigits: 0\r\n    });\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}