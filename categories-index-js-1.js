(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,,,function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return a}));var i=s(11),n=s(12),r=s(9);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{constructor(){o(this,"subElements",{}),o(this,"components",{}),o(this,"onPointerDown",e=>{const t=e.target.closest(".category__header");t&&t.closest(".category").classList.toggle("category_open")}),o(this,"onSortableListReorder",async({detail:e})=>{const t=[...e.children].map((e,t)=>({id:e.dataset.id,weight:t+1}));try{await Object(r.a)("https://course-js.javascript.ru/api/rest/subcategories",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),this.renderNotification("Порядок категорий сохранен!")}catch(e){this.renderNotification("Порядок категорий не сохранен!","error")}})}get getTemplate(){return'\n      <div class="categories">\n        <div class="content__top-panel">\n          <h1 class="page-title">Категории товаров</h1>\n        </div>\n\n        <div data-element="categoriesContainer" class="categoriesContainer"></div>\n      </div>\n    '}get getSubElements(){return[...this.element.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}get getCategoriesWrappers(){const{categoriesContainer:e}=this.subElements;return[...e.querySelectorAll("[data-id]")].reduce((e,t)=>(e[t.dataset.id]=t,e),{})}async render(){const e=document.createElement("div");return e.innerHTML=this.getTemplate,this.element=e.firstElementChild,this.subElements=this.getSubElements,this.categories=await this.getCategories(),this.renderCategories(this.categories),this.addEventListeners(),this.element}async getCategories(){const e=new URL("api/rest/categories","https://course-js.javascript.ru/");return e.searchParams.set("_sort","weight"),e.searchParams.set("_refs","subcategory"),Object(r.a)(e.href)}renderCategories(e){const{categoriesContainer:t}=this.subElements;t.innerHTML=e.map(({id:e,title:t})=>`\n          <div class="category category_open" data-id="${e}">\n            <header class="category__header">\n              ${t}\n            </header>\n            <div class="category__body">\n              <div class="subcategory-list"></div>\n            </div>\n          </div>\n        `).join(""),this.addSubcategories(e)}addSubcategories(e){const t=this.getCategoriesWrappers;e.forEach(({id:e,subcategories:s})=>{const n=new i.a({items:s.map(this.renderSubcategoryItem)});t[e].querySelector(".subcategory-list").append(n.element)})}renderSubcategoryItem({id:e,title:t,count:s}){const i=document.createElement("div");return i.innerHTML=`\n      <li class="categories__sortable-list-item sortable-list__item" data-grab-handle data-id="${e}">\n        <strong>${t}</strong>\n        <span><b>${s}</b> products</span>\n      </li>\n    `,i.firstElementChild}addEventListeners(){const{categoriesContainer:e}=this.subElements;e.addEventListener("sortable-list-reorder",this.onSortableListReorder),document.addEventListener("pointerdown",this.onPointerDown)}renderNotification(e,t="success"){new n.a(e,{duration:2e3,type:t}).show()}removeEventListeners(){document.removeEventListener("pointerdown",this.onPointerDown)}remove(){this.element.remove()}destroy(){this.remove(),this.removeEventListeners();for(const e of Object.values(this.components))e.destroy()}}},,,,,,function(e,t,s){"use strict";t.a=async function(e,t){let s,n;try{s=await fetch(e.toString(),t)}catch(e){throw new i(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{n=await s.json(),e=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new i(s,n,t)}try{return await s.json()}catch(e){throw new i(s,null,e.message)}};class i extends Error{constructor(e,t,s){var i,n,r;super(s),r="FetchError",(n="name")in(i=this)?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof i&&alert(e.reason.message)})},,function(e,t,s){"use strict";function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"a",(function(){return n}));class n{constructor({items:e=[]}){i(this,"onPointerDown",({target:e,offsetX:t})=>{e.closest("[data-delete-handle]")&&this.removeItem(e),e.closest("[data-grab-handle]")&&(e.addEventListener("dragstart",e=>{e.preventDefault()}),this.startDragItem(e,t))}),i(this,"onPointerMove",({clientX:e,clientY:t})=>{const s=t-this.sizes.height/2,i=e-this.sizes.shiftX,{top:n,bottom:r}=this.element.getBoundingClientRect();if(s<n||s>r)return void this.onPointerUp();this.dragItem.style.top=s+"px",this.dragItem.style.left=i+"px",this.dragItem.style.display="none";const o=document.elementFromPoint(e,t).closest(".sortable-list__item");if(o){const{top:e}=o.getBoundingClientRect(),{top:t}=this.placeholder.getBoundingClientRect();s>e&&this.placeholder.before(o),e>s&&e<t&&o.before(this.placeholder)}this.dragItem.style.display=""}),i(this,"onPointerUp",()=>{this.stopDragItem(),document.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp)}),this.items=e,this.render()}get getPlaceholder(){const e=document.createElement("div");return e.classList.add("sortable-list__placeholder"),e.style.width=this.sizes.width+"px",e.style.height=this.sizes.height+"px",e}render(){const e=document.createElement("div");e.innerHTML='<ul class="sortable-list" data-element="sortable-list"></ul>',this.element=e.firstElementChild,this.addItemsToList(),this.addEventListeners()}addItemsToList(){this.items.forEach(e=>{e.classList.add("sortable-list__item"),this.element.append(e)})}addEventListeners(){this.element.addEventListener("selectstart",e=>e.preventDefault()),this.element.addEventListener("pointerdown",this.onPointerDown)}removeItem(e){e.closest(".sortable-list__item").remove()}startDragItem(e,t){this.dragItem=e.closest(".sortable-list__item"),this.elementInitialIndex=[...this.element.children].indexOf(this.dragItem);const{top:s,left:i,width:n,height:r}=this.dragItem.getBoundingClientRect();this.sizes={top:s,left:i,width:n,height:r,shiftX:t},this.placeholder=this.getPlaceholder,this.element.replaceChild(this.placeholder,this.dragItem),this.element.append(this.dragItem),this.dragItem.classList.add("sortable-list__item_dragging"),this.dragItem.style.width=n+"px",this.dragItem.style.height=r+"px",this.dragItem.style.top=s+"px",this.dragItem.style.left=i+"px",document.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp)}stopDragItem(){const e=[...this.element.children].indexOf(this.placeholder);this.dragItem.style.cssText="",this.sizes={},this.dragItem.classList.remove("sortable-list__item_dragging"),this.element.replaceChild(this.dragItem,this.placeholder),this.placeholder.remove(),this.placeholder=null,this.elementInitialIndex!==e&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,detail:this.element}))}remove(){this.element.remove()}destroy(){this.remove(),this.element=null}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e,{duration:t=2e3,type:s="success"}={}){i.instance&&i.instance.remove(),this.message=e,this.duration=t,this.type=s,this.render()}render(){const e=document.createElement("div");e.innerHTML=`\n      <div class="notification notification_${this.type} show" style="--value:${this.duration/1e3}s">\n        <div class="notification__content">${this.message}</div>\n      </div>\n    `,this.element=e.firstElementChild,i.instance=this}show(e=document.body){e.append(this.element),this.timer=setTimeout(this.remove.bind(this),this.duration)}remove(){this.element.remove()}destroy(){this.remove(),i.instance=null,clearTimeout(this.timer)}}}]]);
//# sourceMappingURL=categories-index-js-1.js.map