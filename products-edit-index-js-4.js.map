{"version":3,"sources":["webpack:///./src/utils/escape-html.js","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js"],"names":["string","replace","ProductForm","constructor","productId","title","description","quantity","subcategory","status","images","price","discount","event","preventDefault","this","save","fileInput","document","createElement","hidden","body","append","type","accept","addEventListener","async","file","files","formData","FormData","uploadImage","imageListContainer","subElements","classList","add","disabled","result","fetchJson","method","headers","Authorization","querySelector","renderImageItem","url","data","link","source","name","error","console","remove","click","element","querySelectorAll","reduce","accum","subElement","dataset","categories","getCategories","productData","getProductData","defaultFormData","categoriesData","productResponse","Promise","all","productInfo","innerHTML","getProductForm","firstElementChild","getSubElements","addCategories","addImages","updateForm","addEventListeners","URL","process","searchParams","set","href","getFormData","JSON","stringify","CustomEvent","detail","id","dispatchEvent","productForm","excludedFields","formatToNumber","fields","Object","keys","filter","item","includes","field","dataItem","value","parseInt","image","push","src","alt","sortableList","SortableList","items","map","path","escapeHtml","productCategory","forEach","categoryTitle","subcategories","Option","onSubmit","target","deleteHandle","closest","destroy","EditPage","currentId","pathname","location","match","split","getId","getTemplate","initComponents","renderComponents","render","components","entries","component","renderNotification","message","NotificationMessage","show","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","Error","super","window","reason","alert","offsetX","removeItem","startDragItem","clientX","clientY","dragItemTop","sizes","height","dragItemLeft","shiftX","top","elementTop","bottom","elementBottom","getBoundingClientRect","onPointerUp","dragItem","style","left","display","sortableItemBelow","elementFromPoint","topBoundry","topPlaceholder","placeholder","before","stopDragItem","removeEventListener","onPointerMove","width","addItemsToList","onPointerDown","offsetLeft","elementInitialIndex","children","indexOf","getPlaceholder","replaceChild","placeholderIndex","cssText","bubbles","duration","instance","container","timer","setTimeout","bind","clearTimeout"],"mappings":"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","file":"products-edit-index-js-4.js","sourcesContent":["export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","import SortableList from '../sortable-list/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nexport default class ProductForm {\r\n  defaultFormData = {\r\n    title: '',\r\n    description: '',\r\n    quantity: 1,\r\n    subcategory: '',\r\n    status: 1,\r\n    images: [],\r\n    price: 100,\r\n    discount: 0\r\n  }\r\n\r\n  onSubmit = event => {\r\n    event.preventDefault();\r\n\r\n    this.save();\r\n  }\r\n\r\n  uploadImage = () => {\r\n    const fileInput = document.createElement('input');\r\n    fileInput.hidden = true;\r\n    document.body.append(fileInput);\r\n\r\n    fileInput.type = 'file';\r\n    fileInput.accept = 'image/*';\r\n\r\n    fileInput.addEventListener('change', async () => {\r\n      const [file] = fileInput.files;\r\n\r\n      if (file) {\r\n        const formData = new FormData();\r\n        const { uploadImage, imageListContainer } = this.subElements;\r\n\r\n        formData.append('image', file);\r\n\r\n        uploadImage.classList.add('is-loading');\r\n        uploadImage.disabled = true;\r\n\r\n        try {\r\n          const result = await fetchJson('https://api.imgur.com/3/image', {\r\n            method: 'POST',\r\n            headers: {\r\n              Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\r\n            },\r\n            body: formData\r\n          });\r\n  \r\n          const imagesList = imageListContainer.querySelector('ul.sortable-list');\r\n\r\n          imagesList.append(this.renderImageItem({\r\n            url: result.data.link,\r\n            source: file.name\r\n          }));\r\n        } catch(error) {\r\n          console.error('Ошибка при загрузке изображения!', error);\r\n        }  \r\n\r\n        uploadImage.classList.remove('is-loading');\r\n        uploadImage.disabled = false;\r\n\r\n        fileInput.remove();\r\n      }\r\n    });\r\n\r\n    fileInput.click();\r\n  }\r\n\r\n  constructor(productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  get getProductForm() {\r\n    return `\r\n      <div class=\"product-form\">\r\n\r\n        <form data-element=\"productForm\" class=\"form-grid\">\r\n\r\n          <div class=\"form-group form-group__half_left\">\r\n            <fieldset>\r\n              <label class=\"form-label\">Название товара</label>\r\n              <input required=\"\" type=\"text\" name=\"title\" id=\"title\" class=\"form-control\" placeholder=\"Название товара\" data-element=\"productName\">\r\n            </fieldset>\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__wide\">\r\n            <label class=\"form-label\">Описание</label>\r\n            <textarea required=\"\" class=\"form-control\" name=\"description\" id=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\r\n            <label class=\"form-label\">Фото</label>\r\n            <div data-element=\"imageListContainer\"></div>\r\n            <button type=\"button\" name=\"uploadImage\" id=\"uploadImage\" data-element=\"uploadImage\" class=\"button-primary-outline\"><span>Загрузить</span></button>\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__half_left\">\r\n            <label class=\"form-label\">Категория</label>\r\n            <select class=\"form-control\" name=\"subcategory\" id=\"subcategory\" data-element=\"productCategory\"></select>\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__half_left form-group__two-col\">\r\n            <fieldset>\r\n              <label class=\"form-label\">Цена ($)</label>\r\n              <input required=\"\" type=\"number\" name=\"price\" id=\"price\" class=\"form-control\" placeholder=\"100\" data-element=\"productPrice\">\r\n            </fieldset>\r\n            <fieldset>\r\n              <label class=\"form-label\">Скидка ($)</label>\r\n              <input required=\"\" type=\"number\" name=\"discount\" id=\"discount\" class=\"form-control\" placeholder=\"0\" data-element=\"productDiscount\">\r\n            </fieldset>\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__part-half\">\r\n            <label class=\"form-label\">Количество</label>\r\n            <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" id=\"quantity\" placeholder=\"1\" data-element=\"productQuantity\">\r\n          </div>\r\n\r\n          <div class=\"form-group form-group__part-half\">\r\n            <label class=\"form-label\">Статус</label>\r\n            <select class=\"form-control\" name=\"status\" id=\"status\" data-element=\"productStatus\">\r\n              <option value=\"1\">Активен</option>\r\n              <option value=\"0\">Неактивен</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"form-buttons\">\r\n            <button type=\"submit\" name=\"save\" id=\"save\" class=\"button-primary-outline\">\r\n              Сохранить товар\r\n            </button>\r\n          </div>          \r\n        </form>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  get getSubElements() {\r\n    const subElements = this.element.querySelectorAll('[data-element]');\r\n\r\n    return [...subElements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  async render() {\r\n    const categories = this.getCategories();\r\n\r\n    const productData = this.productId ?\r\n      this.getProductData(this.productId) :\r\n      [this.defaultFormData];\r\n\r\n    const [categoriesData, productResponse] = await Promise.all([categories, productData]);\r\n    const [productInfo] = productResponse;\r\n\r\n    this.categories = categoriesData;\r\n    this.formData = productInfo;\r\n\r\n    const element = document.createElement('div');\r\n    element.innerHTML = this.getProductForm;\r\n    this.element = element.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements;\r\n\r\n    this.addCategories(this.categories);\r\n    this.addImages(this.formData.images);\r\n    this.updateForm();\r\n\r\n    this.addEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  async getProductData(productId) {\r\n    const url = new URL(`${process.env.DATA_API}/products`, process.env.BACKEND_URL);\r\n    url.searchParams.set(`id`, productId);\r\n\r\n    return fetchJson(url.href);\r\n  }\r\n\r\n  async getCategories() {\r\n    const url = new URL(`${process.env.DATA_API}/categories`, process.env.BACKEND_URL);\r\n    url.searchParams.set(`_sort`, `weight`);\r\n    url.searchParams.set(`_refs`, `subcategory`);\r\n\r\n    return fetchJson(url.href);\r\n  }\r\n\r\n  async save() {\r\n    const formData = this.getFormData();\r\n\r\n    const result = await fetchJson(`${process.env.BACKEND_URL}${process.env.DATA_API}/products`, {\r\n      method: this.productId ? 'PATCH' : 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(formData)\r\n    });\r\n\r\n    const event = this.productId ?\r\n      new CustomEvent('product-updated', {\r\n        detail: result.id\r\n      }) :\r\n      new CustomEvent('product-saved');\r\n\r\n    this.element.dispatchEvent(event);\r\n  }\r\n\r\n  getFormData() {\r\n    const { productForm, imageListContainer } = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const formatToNumber = ['price', 'quantity', 'discount', 'status'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n    const data = {};\r\n\r\n    data.images = [];\r\n    data.id = this.productId;\r\n\r\n    for (const field of fields) {\r\n      const dataItem = productForm.querySelector(`[name=${field}]`).value;\r\n\r\n      data[field] = formatToNumber.includes(field) ?\r\n        parseInt(dataItem) :\r\n        dataItem;\r\n    }\r\n\r\n    const images = imageListContainer.querySelectorAll('.sortable-table__cell-img');\r\n\r\n    for (const image of images) {\r\n      data.images.push({\r\n        url: image.src,\r\n        source: image.alt\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  addImages(images = []) {\r\n    const sortableList = new SortableList({\r\n      items: images.map(image => this.renderImageItem(image))\r\n    });\r\n\r\n    this.subElements.imageListContainer.append(sortableList.element);\r\n  }\r\n\r\n  renderImageItem({ source, url }) {\r\n    const image = document.createElement('div');\r\n    const path = process.env.NODE_ENV === 'production' ?\r\n    `${URL_PATH}/` :\r\n    '../'\r\n\r\n    image.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\" style=\"\">\r\n        <input type=\"hidden\" name=\"url\" value=\"${escapeHtml(url)}\">\r\n        <input type=\"hidden\" name=\"source\" value=\"${escapeHtml(source)}\">\r\n        <span>\r\n          <img src=\"${path}icon-grab.svg\" data-grab-handle=\"\" alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${url}\">\r\n          <span>${escapeHtml(source)}</span>\r\n        </span>\r\n        <button type=\"button\">\r\n          <img src=\"${path}icon-trash.svg\" data-delete-handle=\"\" alt=\"delete\">\r\n        </button>\r\n        </span>\r\n      </li>\r\n    `;\r\n\r\n    return image.firstElementChild;\r\n  }\r\n\r\n  addCategories(categories = []) {\r\n    const subcategory = this.subElements.productCategory;\r\n\r\n    categories.forEach(({ title: categoryTitle, subcategories }) => {\r\n      subcategories.forEach(({ id, title }) => {\r\n        subcategory.append(new Option(`${categoryTitle} > ${title}`, id));\r\n      });\r\n    });\r\n  }\r\n\r\n  updateForm() {\r\n    const { productForm } = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n\r\n    fields.forEach(field => {\r\n      const element = productForm.querySelector(`#${field}`);\r\n\r\n      element.value = this.formData[field] || this.defaultFormData[field];\r\n    });\r\n  }\r\n\r\n  addEventListeners() {\r\n    const { productForm, uploadImage, imageListContainer } = this.subElements;\r\n\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n    uploadImage.addEventListener('click', this.uploadImage);\r\n\r\n    imageListContainer.addEventListener('click', event => {\r\n      if (event.target.dataset.deleteHandle === '') {\r\n        event.target.closest('li').remove();\r\n      }\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = {};\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n}\r\n","import ProductForm from '../../../components/product-form/index.js';\r\nimport NotificationMessage from '../../../components/notification/index.js';\r\n\r\nexport default class EditPage {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n  currentId = '';\r\n\r\n  get getTemplate() {\r\n    return `\r\n      <div class=\"products-edit\">\r\n        <div class=\"content__top-panel\">\r\n        <h1 class=\"page-title\">\r\n            <a href=\"/products\" class=\"link\">Товары</a> / ${this.currentId ? \"Редактировать\" : \"Добавить\"} \r\n          </h1>\r\n        </div>\r\n        <div class=\"content-box\">       \r\n          <div data-element=\"productForm\" class=\"product-form\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  get getId() {\r\n    const { pathname } = location;\r\n\r\n    return pathname.match(/products\\/add/) ?\r\n      \"\" :\r\n      pathname.split('/products/')[1];\r\n  }\r\n\r\n  get getSubElements() {\r\n    const subElements = this.element.querySelectorAll('[data-element]');\r\n\r\n    return [...subElements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  async render() {\r\n    this.currentId = this.getId;\r\n\r\n    const element = document.createElement('div');\r\n    element.innerHTML = this.getTemplate;\r\n    this.element = element.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements;\r\n\r\n    await this.initComponents();\r\n    this.renderComponents();\r\n\r\n    this.addEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  async initComponents() {\r\n    const productForm = new ProductForm(this.currentId);\r\n    await productForm.render();\r\n\r\n    this.components = {productForm};\r\n  }\r\n\r\n  renderComponents() {\r\n    Object.entries(this.components).forEach(([title, component]) => {\r\n      const container = this.subElements[title];\r\n\r\n      container.append(component.element);\r\n    });\r\n  }\r\n\r\n  renderNotification(message) {\r\n    const notification = new NotificationMessage(message);\r\n    notification.show();\r\n  }\r\n\r\n  addEventListeners() {\r\n    const { productForm } = this.components;\r\n\r\n    productForm.element.addEventListener('product-saved', () => {\r\n      this.renderNotification('Товар добавлен!');\r\n    });\r\n\r\n    productForm.element.addEventListener('product-updated', () => {\r\n      this.renderNotification('Товар обновлен!');\r\n    });\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n","export default class SortableList {\r\n  onPointerDown = ({ target, offsetX }) => {\r\n    if (target.closest('[data-delete-handle]')) {\r\n      this.removeItem(target);\r\n    }\r\n\r\n    if (target.closest('[data-grab-handle]')) {\r\n      target.addEventListener('dragstart', event => {\r\n        event.preventDefault();\r\n      });\r\n\r\n      this.startDragItem(target, offsetX);\r\n    }\r\n  }\r\n\r\n  onPointerMove = ({ clientX, clientY }) => {\r\n    const dragItemTop = clientY - this.sizes.height / 2;\r\n    const dragItemLeft = clientX - this.sizes.shiftX;    \r\n    const { top: elementTop, bottom: elementBottom } = this.element.getBoundingClientRect();\r\n\r\n    if (dragItemTop < elementTop || dragItemTop > elementBottom) {\r\n      this.onPointerUp();\r\n      return;\r\n    }\r\n\r\n    this.dragItem.style.top = `${dragItemTop}px`;\r\n    this.dragItem.style.left = `${dragItemLeft}px`;\r\n    this.dragItem.style.display = 'none';\r\n\r\n    const elementBelow = document.elementFromPoint(clientX, clientY);\r\n    const sortableItemBelow = elementBelow.closest(`.sortable-list__item`);\r\n\r\n    if (sortableItemBelow) {\r\n      const {\r\n        top: topBoundry\r\n      } = sortableItemBelow.getBoundingClientRect();\r\n      const {\r\n        top: topPlaceholder\r\n      } = this.placeholder.getBoundingClientRect();\r\n\r\n      if (dragItemTop > topBoundry) {\r\n        this.placeholder.before(sortableItemBelow);\r\n      }\r\n\r\n      if (topBoundry > dragItemTop && topBoundry < topPlaceholder) {\r\n        sortableItemBelow.before(this.placeholder);\r\n      }\r\n    } \r\n    \r\n    this.dragItem.style.display = '';\r\n  }\r\n\r\n  onPointerUp = () => {\r\n    this.stopDragItem();\r\n\r\n    document.removeEventListener('pointermove', this.onPointerMove);    \r\n    this.element.removeEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  constructor({ items = [] }) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  get getPlaceholder() {\r\n    const placeholder = document.createElement('div');\r\n    placeholder.classList.add('sortable-list__placeholder');\r\n\r\n    placeholder.style.width = `${this.sizes.width}px`;\r\n    placeholder.style.height = `${this.sizes.height}px`;\r\n\r\n    return placeholder;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n    element.innerHTML = `<ul class=\"sortable-list\" data-element=\"sortable-list\"></ul>`;\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.addItemsToList();\r\n    this.addEventListeners();\r\n  }\r\n\r\n  addItemsToList() {\r\n    this.items.forEach(item => {\r\n      item.classList.add(`sortable-list__item`);\r\n      this.element.append(item);\r\n    });\r\n  }\r\n\r\n  addEventListeners() {\r\n    this.element.addEventListener('selectstart', event => event.preventDefault());\r\n    this.element.addEventListener('pointerdown', this.onPointerDown);\r\n  }\r\n\r\n  removeItem(target) {\r\n    target.closest(`.sortable-list__item`).remove();\r\n  }\r\n\r\n  startDragItem(target, offsetLeft) {\r\n    this.dragItem = target.closest(`.sortable-list__item`);\r\n    this.elementInitialIndex = [...this.element.children]\r\n      .indexOf(this.dragItem);\r\n\r\n    const { top, left, width, height } = this.dragItem.getBoundingClientRect();\r\n    this.sizes = {\r\n      top,\r\n      left,\r\n      width,\r\n      height,\r\n      shiftX: offsetLeft\r\n    };\r\n    \r\n    this.placeholder = this.getPlaceholder;\r\n    \r\n    this.element.replaceChild(this.placeholder, this.dragItem);\r\n    this.element.append(this.dragItem);\r\n\r\n    this.dragItem.classList.add(`sortable-list__item_dragging`);\r\n    this.dragItem.style.width = `${width}px`;\r\n    this.dragItem.style.height = `${height}px`;\r\n    this.dragItem.style.top = `${top}px`;\r\n    this.dragItem.style.left = `${left}px`;\r\n\r\n    document.addEventListener('pointermove', this.onPointerMove);    \r\n    this.element.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  stopDragItem() {\r\n    const placeholderIndex = [...this.element.children]\r\n      .indexOf(this.placeholder);\r\n\r\n    this.dragItem.style.cssText = ``;\r\n\r\n    this.sizes = {};\r\n\r\n    this.dragItem.classList.remove(`sortable-list__item_dragging`);\r\n    this.element.replaceChild(this.dragItem, this.placeholder);\r\n\r\n    this.placeholder.remove();\r\n    this.placeholder = null;\r\n\r\n    if (this.elementInitialIndex !== placeholderIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        detail: this.element\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n  }\r\n}\r\n","export default class NotificationMessage {\n  constructor(message, {\n    duration = 2000,\n    type = 'success'\n  } = {}) {\n    if (NotificationMessage.instance) {\n      NotificationMessage.instance.remove();\n    }\n\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n    \n    this.render();\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = `\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${this.duration / 1000}s\">\n        <div class=\"notification__content\">${this.message}</div>\n      </div>\n    `;\n    this.element = element.firstElementChild;\n    NotificationMessage.instance = this;\n  }\n\n  show(container = document.body) {\n    container.append(this.element);\n\n    this.timer = setTimeout(this.remove.bind(this), this.duration);\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n    NotificationMessage.instance = null;\n    clearTimeout(this.timer);\n  }\n\n}\n"],"sourceRoot":""}